<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2086px" preserveAspectRatio="none" style="width:995px;height:2086px;background:#FFFFFF;" version="1.1" viewBox="0 0 995 2086" width="995px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="monospace" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="552" x="217.5" y="27.9079">VCMI-1.3.2&#160;communication&#160;sequence&#160;for&#160;starting&#160;and&#160;replaying&#160;a&#160;battle</text><rect fill="none" height="136.0001" style="stroke:#000000;stroke-width:1.5;" width="266" x="365" y="595.7281"/><rect fill="none" height="136.0001" style="stroke:#000000;stroke-width:1.5;" width="266" x="365" y="1288.8565"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="406" x2="406" y1="74.5999" y2="2050.2505"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="590" x2="590" y1="74.5999" y2="2050.2505"/><rect fill="#E2E2F0" height="30.7999" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="62" x="375" y="42.7999"/><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="48" x="382" y="62.7639">Server</text><rect fill="#E2E2F0" height="30.7999" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="62" x="375" y="2049.2505"/><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="48" x="382" y="2069.2144">Server</text><rect fill="#E2E2F0" height="30.7999" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="62" x="559" y="42.7999"/><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="48" x="566" y="62.7639">Client</text><rect fill="#E2E2F0" height="30.7999" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="62" x="559" y="2049.2505"/><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="48" x="566" y="2069.2144">Client</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="988" x="0" y="105.1663"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="988" y1="105.1663" y2="105.1663"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="988" y1="108.1663" y2="108.1663"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="150" x="419" y="94.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="131" x="425" y="110.6667">&#171;Adventure map&#187;</text><polygon fill="#181818" points="417,145.3327,407,149.3327,417,153.3327,413,149.3327" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="411" x2="589" y1="149.3327" y2="149.3327"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="466" y="143.7707">MoveHero</text><polygon fill="#181818" points="578,174.9327,588,178.9327,578,182.9327,582,178.9327" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="178.9327" y2="178.9327"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="446" y="173.3707">PlayerBlocked</text><polygon fill="#181818" points="578,204.5327,588,208.5327,578,212.5327,582,208.5327" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="208.5327" y2="208.5327"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="438" y="202.9707">HeroVisitCastle</text><polygon fill="#181818" points="578,234.1327,588,238.1327,578,242.1327,582,238.1327" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="238.1327" y2="238.1327"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="454" y="232.5707">TryMoveHero</text><polygon fill="#181818" points="578,263.7327,588,267.7327,578,271.7327,582,267.7327" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="267.7327" y2="267.7327"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="462" y="262.1707">HeroVisit</text><polygon fill="#181818" points="578,293.3327,588,297.3327,578,301.3327,582,297.3327" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="297.3327" y2="297.3327"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="136" x="430" y="291.7707">SetObjectProperty</text><polygon fill="#181818" points="578,355.9648,588,359.9648,578,363.9648,582,359.9648" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="359.9648" y2="359.9648"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="136" x="430" y="354.4028">RebalanceStacks&#160;*</text><path d="M595,310.3327 L595,395.3327 L978,395.3327 L978,320.3327 L968,310.3327 L595,310.3327 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M968,310.3327 L968,320.3327 L978,320.3327 L968,310.3327 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="722" y="327.3996">* called many times</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="638.5" y="342.5325">neutral army is treated like a 7-slot hero army</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="696.5" y="357.6653">with all units in the first slot.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="616.5" y="372.7981">Rebalancing splits them into more slots before battle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="353" x="610" y="387.9309">Each call moves a number of units from slot 0 to slot X</text><polygon fill="#181818" points="578,418.5968,588,422.5968,578,426.5968,582,422.5968" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="422.5968" y2="422.5968"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="434" y="417.0348">PlayerBlocked&#160;**</text><polygon fill="#181818" points="578,450.9632,588,454.9632,578,458.9632,582,454.9632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="454.9632" y2="454.9632"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="434" y="449.4012">PlayerBlocked&#160;**</text><path d="M595,435.5968 L595,460.5968 L847,460.5968 L847,445.5968 L837,435.5968 L595,435.5968 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M837,435.5968 L837,445.5968 L847,445.5968 L837,435.5968 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="610" y="452.6637">** not sure which of those unblock</text><polygon fill="#181818" points="578,483.3297,588,487.3297,578,491.3297,582,487.3297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="487.3297" y2="487.3297"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="454" y="481.7676">BattleStart</text><polygon fill="#181818" points="578,523.2625,588,527.2625,578,531.2625,582,527.2625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="527.2625" y2="527.2625"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="426" y="521.7005">PackageApplied&#160;***</text><path d="M595,500.3297 L595,540.3297 L892,540.3297 L892,510.3297 L882,500.3297 L595,500.3297 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M882,500.3297 L882,510.3297 L892,510.3297 L882,500.3297 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267" x="610" y="517.3965">*** not sure if battlefield is rendered here</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="633.5" y="532.5294">or on some of the previus packets</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="988" x="0" y="566.1617"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="988" y1="566.1617" y2="566.1617"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="988" y1="569.1617" y2="569.1617"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="128" x="430" y="555.5953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="109" x="436" y="571.6622">&#171;Battle start&#187;</text><path d="M365,595.7281 L618,595.7281 L618,603.3281 L608,613.3281 L365,613.3281 L365,595.7281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="136.0001" style="stroke:#000000;stroke-width:1.5;" width="266" x="365" y="595.7281"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="208" x="380" y="608.7141">Actions&#160;(separate&#160;diagram)</text><polygon fill="#181818" points="578,630.9281,588,634.9281,578,638.9281,582,634.9281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="634.9281" y2="634.9281"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="438" y="629.3661">BattleNextRound</text><polygon fill="#181818" points="578,660.5281,588,664.5281,578,668.5281,582,664.5281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="664.5281" y2="664.5281"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="418" y="658.9661">BattleSetActiveStack</text><polygon fill="#181818" points="417,690.1281,407,694.1281,417,698.1281,413,694.1281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="411" x2="589" y1="694.1281" y2="694.1281"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="458" y="688.5661">MakeAction</text><polygon fill="#181818" points="417,719.7282,407,723.7282,417,727.7282,413,723.7282" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="578,719.7282,588,723.7282,578,727.7282,582,723.7282" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="411" x2="584" y1="723.7282" y2="723.7282"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="486" y="718.1662">...</text><polygon fill="#181818" points="578,848.7938,588,852.7938,578,856.7938,582,852.7938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="852.7938" y2="852.7938"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="450" y="847.2318">BattleResult</text><path d="M64,791.661 L64,832.661 L401,832.661 L401,801.661 L391,791.661 L64,791.661 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M391,791.661 L391,801.661 L401,801.661 L391,791.661 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="79" y="808.699">addQuery</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="147" y="809.1951">of type</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="136" x="197" y="808.699">BattleDialogQuery</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="337" y="809.1951">(ID=34)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="91.5" y="824.7951">which causes the sending of</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="277.5" y="824.299">BattleResult</text><path d="M595,768.7282 L595,855.7282 L932,855.7282 L932,778.7282 L922,768.7282 L595,768.7282 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M922,768.7282 L922,778.7282 L932,778.7282 L922,768.7282 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="662.5" y="785.7951">client shows battle result dialog</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="640.5" y="801.3951">(pack contains a</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="749.5" y="800.899">replayAllowed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="857.5" y="801.3951">flag)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="761.5" y="816.5279">&#160;</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="610" y="832.1279">NetPacksClient.cpp:767</text><text fill="#808080" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="152" x="765" y="831.6318">(visitBattleResult)</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="636.5" y="847.7279">CPlayerInterface.cpp:843</text><text fill="#808080" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="802.5" y="847.2318">(battleEnd)</text><polygon fill="#181818" points="601,878.3938,591,882.3938,601,886.3938,597,882.3938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="595" x2="797" y1="882.3938" y2="882.3938"/><text fill="#000000" font-family="monospace" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="184" x="602" y="877.3128">(replay&#160;battle&#160;clicked)</text><polygon fill="#181818" points="417,987.8259,407,991.8259,417,995.8259,413,991.8259" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="411" x2="589" y1="991.8259" y2="991.8259"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="458" y="986.2639">QueryReply</text><path d="M5,895.3938 L5,1074.3938 L401,1074.3938 L401,905.3938 L391,895.3938 L5,895.3938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M391,895.3938 L391,905.3938 L401,905.3938 L391,895.3938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="68.5" y="912.4318">popQuery(BattleDialogQuery)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="288.5" y="912.9279">(ID=34)</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="72.5" y="928.5279">CGameHandler.cpp:4340</text><text fill="#808080" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="237.5" y="928.0319">(queryReply)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="20" y="944.128">&gt;</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="352" x="34" y="943.6319">if(*answer&#160;==&#160;1)&#160;gh-&gt;startBattlePrimary(...)</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="25" y="959.728">CQuery.cpp:417</text><text fill="#808080" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="248" x="133" y="959.2319">(CBattleDialogQuery::onRemoval)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="201" y="974.8608">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="181.5" y="989.9936">...(???)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="201" y="1005.1264">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="121" y="1020.2592">TODO: verify order below</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="150.5" y="1035.392">(re-)setup battle</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="90.5" y="1050.9921">BattleInfo.cpp:194</text><text fill="#808080" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="211.5" y="1050.496">(setupBattle)</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="92.5" y="1066.096">addQuery(BattleQuery)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="264.5" y="1066.5921">(ID=35)</text><polygon fill="#181818" points="578,1100.0244,588,1104.0244,578,1108.0244,582,1104.0244" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1104.0244" y2="1104.0244"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="446" y="1098.4624">PlayerBlocked</text><path d="M595,1084.658 L595,1109.658 L906,1109.658 L906,1094.658 L896,1084.658 L595,1084.658 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M896,1084.658 L896,1094.658 L906,1094.658 L896,1084.658 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="610" y="1101.7249">start, reason=UPCOMING_BATTLE, player=0</text><polygon fill="#181818" points="578,1135.1572,588,1139.1572,578,1143.1572,582,1139.1572" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1139.1572" y2="1139.1572"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="446" y="1133.5952">PlayerBlocked</text><path d="M595,1119.7908 L595,1144.7908 L922,1144.7908 L922,1129.7908 L912,1119.7908 L595,1119.7908 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M912,1119.7908 L912,1129.7908 L922,1129.7908 L912,1119.7908 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="610" y="1136.8577">start, reason=UPCOMING_BATTLE, player=255</text><polygon fill="#181818" points="578,1167.5236,588,1171.5236,578,1175.5236,582,1171.5236" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1171.5236" y2="1171.5236"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="454" y="1165.9616">BattleStart</text><polygon fill="#181818" points="578,1197.1236,588,1201.1236,578,1205.1236,582,1201.1236" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1201.1236" y2="1201.1236"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="470" y="1195.5616">SetMana</text><polygon fill="#181818" points="578,1226.7236,588,1230.7236,578,1234.7236,582,1230.7236" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1230.7236" y2="1230.7236"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="426" y="1225.1616">PackageApplied&#160;***</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="988" x="0" y="1259.2901"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="988" y1="1259.2901" y2="1259.2901"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="988" y1="1262.2901" y2="1262.2901"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="128" x="430" y="1248.7236"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="109" x="436" y="1264.7905">&#171;Battle start&#187;</text><path d="M365,1288.8565 L618,1288.8565 L618,1296.4565 L608,1306.4565 L365,1306.4565 L365,1288.8565 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="136.0001" style="stroke:#000000;stroke-width:1.5;" width="266" x="365" y="1288.8565"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="208" x="380" y="1301.8425">Actions&#160;(separate&#160;diagram)</text><polygon fill="#181818" points="578,1324.0565,588,1328.0565,578,1332.0565,582,1328.0565" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1328.0565" y2="1328.0565"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="438" y="1322.4945">BattleNextRound</text><polygon fill="#181818" points="578,1353.6565,588,1357.6565,578,1361.6565,582,1357.6565" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1357.6565" y2="1357.6565"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="418" y="1352.0945">BattleSetActiveStack</text><polygon fill="#181818" points="417,1383.2565,407,1387.2565,417,1391.2565,413,1387.2565" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="411" x2="589" y1="1387.2565" y2="1387.2565"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="458" y="1381.6945">MakeAction</text><polygon fill="#181818" points="417,1412.8565,407,1416.8565,417,1420.8565,413,1416.8565" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="578,1412.8565,588,1416.8565,578,1420.8565,582,1416.8565" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="411" x2="584" y1="1416.8565" y2="1416.8565"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="486" y="1411.2945">...</text><polygon fill="#181818" points="578,1449.4565,588,1453.4565,578,1457.4565,582,1453.4565" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1453.4565" y2="1453.4565"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="450" y="1447.8945">BattleResult</text><polygon fill="#181818" points="601,1479.0566,591,1483.0566,601,1487.0566,597,1483.0566" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="595" x2="861" y1="1483.0566" y2="1483.0566"/><text fill="#000000" font-family="monospace" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="248" x="602" y="1477.9756">(OK&#160;clicked&#160;-&#160;no&#160;replay&#160;option)</text><polygon fill="#181818" points="417,1581.1558,407,1585.1558,417,1589.1558,413,1585.1558" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="411" x2="589" y1="1585.1558" y2="1585.1558"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="458" y="1579.5938">QueryReply</text><path d="M15,1496.0566 L15,1660.0566 L401,1660.0566 L401,1506.0566 L391,1496.0566 L15,1496.0566 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M391,1496.0566 L391,1506.0566 L401,1506.0566 L391,1496.0566 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="73.5" y="1513.0946">popQuery(BattleDialogQuery)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="293.5" y="1513.5907">(ID=34)</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="77.5" y="1529.1907">CGameHandler.cpp:4340</text><text fill="#808080" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="242.5" y="1528.6946">(queryReply)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="109" y="1544.7907">&gt;</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="123" y="1544.2946">gh-&gt;endBattleConfirm();</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="30" y="1560.3907">CQuery.cpp:421</text><text fill="#808080" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="248" x="138" y="1559.8946">(CBattleDialogQuery::onRemoval)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="206" y="1575.5235">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="126.5" y="1590.6563">apply results after battle:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="206" y="1605.7891">&#160;</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="124" y="1620.8931">cab1.updateArmy(this)</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="124" y="1636.4931">cab2.updateArmy(this)</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="57.5" y="1652.5892">CGameHandler.cpp:801</text><text fill="#808080" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="214.5" y="1652.0931">(endBattleConfirm)</text><polygon fill="#181818" points="578,1686.0215,588,1690.0215,578,1694.0215,582,1690.0215" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1690.0215" y2="1690.0215"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="458" y="1684.4595">EraseStack</text><path d="M595,1670.6551 L595,1695.6551 L953,1695.6551 L953,1680.6551 L943,1670.6551 L595,1670.6551 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M943,1670.6551 L943,1680.6551 L953,1680.6551 L943,1670.6551 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="610" y="1687.722">army #502, slot #0 (hero army stack of skeletons)</text><polygon fill="#181818" points="578,1721.1543,588,1725.1543,578,1729.1543,582,1725.1543" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1725.1543" y2="1725.1543"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="458" y="1719.5923">EraseStack</text><path d="M595,1705.7879 L595,1730.7879 L976,1730.7879 L976,1715.7879 L966,1705.7879 L595,1705.7879 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M966,1705.7879 L966,1715.7879 L976,1715.7879 L966,1705.7879 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="351" x="610" y="1722.8548">army #502, slot #1 (hero army stack of walking dead)</text><polygon fill="#181818" points="578,1756.2871,588,1760.2871,578,1764.2871,582,1760.2871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1760.2871" y2="1760.2871"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="450" y="1754.7251">RemoveObject</text><path d="M595,1740.9207 L595,1765.9207 L761,1765.9207 L761,1750.9207 L751,1740.9207 L595,1740.9207 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M751,1740.9207 L751,1750.9207 L761,1750.9207 L751,1740.9207 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="610" y="1757.9876">object id #502 (hero)</text><polygon fill="#181818" points="578,1788.6535,588,1792.6535,578,1796.6535,582,1792.6535" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1792.6535" y2="1792.6535"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="418" y="1787.0915">BattleResultAccepted</text><polygon fill="#181818" points="578,1818.2536,588,1822.2536,578,1826.2536,582,1822.2536" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1822.2536" y2="1822.2536"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="418" y="1816.6916">BattleResultsApplied</text><polygon fill="#181818" points="578,1847.8536,588,1851.8536,578,1855.8536,582,1851.8536" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1851.8536" y2="1851.8536"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="136" x="430" y="1846.2916">RebalanceStacks&#160;*</text><polygon fill="#181818" points="578,1902.9192,588,1906.9192,578,1910.9192,582,1906.9192" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1906.9192" y2="1906.9192"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="136" x="430" y="1901.3572">SetObjectProperty</text><path d="M595,1864.8536 L595,1934.8536 L920,1934.8536 L920,1874.8536 L910,1864.8536 L595,1864.8536 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M910,1864.8536 L910,1874.8536 L920,1874.8536 L910,1864.8536 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="656.5" y="1881.9205">used for updating various stuff,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295" x="610" y="1897.0533">eg. new monster power rating after the battle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="611.5" y="1912.1861">or new monster stack experience (if enabled)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="679.5" y="1927.3189">or new mine owner, etc.</text><polygon fill="#181818" points="578,1960.7512,588,1964.7512,578,1968.7512,582,1964.7512" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1964.7512" y2="1964.7512"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="462" y="1959.1892">HeroVisit</text><path d="M595,1945.3848 L595,1970.3848 L819,1970.3848 L819,1955.3848 L809,1945.3848 L595,1945.3848 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M809,1945.3848 L809,1955.3848 L819,1955.3848 L809,1945.3848 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="610" y="1962.4517">player #0, hero #502, obj #-1</text><polygon fill="#181818" points="578,1995.884,588,1999.884,578,2003.884,582,1999.884" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="1999.884" y2="1999.884"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="446" y="1994.322">PlayerBlocked</text><path d="M595,1980.5176 L595,2005.5176 L868,2005.5176 L868,1990.5176 L858,1980.5176 L595,1980.5176 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M858,1980.5176 L858,1990.5176 L868,1990.5176 L858,1980.5176 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="610" y="1997.5845">release, reason ONGOING_MOVEMENT</text><polygon fill="#181818" points="578,2028.2505,588,2032.2505,578,2036.2505,582,2032.2505" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="406" x2="584" y1="2032.2505" y2="2032.2505"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="442" y="2026.6885">PackageApplied</text><!--SRC=[tLTjJnj74Fw-ls9ooGUViGtcfKbTREG0JL0Bfa2ZVglMTtFsrkVTo-wU7KjHVdjdTyzWu81MLQMgNv3nlCyyy-pO2fiZH9-Epy_QtSvUPnSIDP-NKYJS2YN1uESIPOAGAGt6Scs5d02NAMWiShxo_y6OMt8JCMPcGXPSypcSOCRBtDxW5plCnKJEKLf8w0_gnre_Acal-1nXhgGo1KymtL2whd8u4GkHehvLlkRINACMsORkXR9Oey1UPQLCV4LlZ4uQRtALjE0DVHcpLnfjgIL4XvboEQfSwVv4yzKWsd9wMn54Mq7Okyjlq20fsMz5yU6samqYzWfbkex362jSjn9HSF9AQInG0pVKKVVfdl0u5wux94py9yRwVJWyX66weFzAJNtX1Gm6qEyp5bIWFQWyzU1SBV0ZQiN25quKb7fmIID2_PwgcBcMFf8xiq_227lC3KsmHkD6hvxnVsjV8xj6Enh_WOczrAf0RLSrEbSuvZcdsLvRdimCD1cJD47GOZArx5iJ4fxdc5BzSWLMpD4mYQNLF0UkvoiG1gn6Raab5pCaABvjcrnPc59YNeKjXPq2UG42jJKW9DWfmLbeOy6fTjWw2OTbK-HEYrJcf6eL8PBQx_GCZ35p_mImirEUJ7rwfB90Gw5bEHzJUIghGcLQpRqfx01vyfz-OuGHS3MobyO5pUPVKRdhLm- -DPlEDnY7cULKK8QKZPqgWvJJs1dLk7pl2xfsorqNa0R39pWig3C-OlF-Y3P3YgpgJYOmJzrqD9MBckne8CY8GnodADfDdnT2eN4XIWEqKpEqPgCxOGL2Re5vrXimqQeiOEZNp433e5jzoYWLdDPs7ZE0fugy83gwKgLCdz4Xt3hVYu19KgpPE3x34F_Ep-66eqwduofXNxz-VRBVLsY8-K8lgM6MHH5FqrzArAieykrP5SJCKT0-4JnNaxMqSNRItzkFMHXnmak37hEKYqmTZCbyRHdYHD5TQpV6LvLcfcffgj7Ho9o1woP5P0qt6I95QRcG3kLH59X_cETgYIbba-Ly4ZFcYJMwGEiGOmAdTPAYwBtzxctKWcZXUE9UJd5bSnn0VUOUXup8rLkzszzpLY6fKvcIzXqughmFsqVGW-tjHaXfNG59tNR4szkFs9BKVHElo61rh_c5AhoayQZXyKR7guG_qFFoaLx17BLFTdzlVyTb-_dMDwKxe5w9hD6aLsX9aGdGtHWcq_R0epc4kTHYpYae8OR2hDtxiC5nr_Vk-55IlPwILqZKmtCAnSY-SNHqH9zkHYUZ7YpSixS2fMdxYBXeL8oQr8uDlNN5ci92jE3wJ6RAH-n-l-yYUiKW8lztsApQSxyn1_4pj0OFdw5DnlAjQ17ck56o_-lbyUZyxEB3x- -7DpS_dxQWy8RzdN_3wUx1GPtRJJQianCzd7F9QpDwJ9N_2nfxYSCURkFef_KAGfj0KPsAe0eNwh-mbMu9gR3WyrX9kWRcZVY7sWNSxVwb1UGqz5N5dKIJcNLxvsrwZEf8-BZRAOkK1ZoagwHXfyAuXVUItJh94pMzs_7vFCm-Uc43JpKt5H8sDyKVKQyFTdPRuJnvlGEDszF9mPMudzuICyCSBS4q_YU-kxM-bpoVkIShHPxMklTDnd1AtWkW_5SWKXybE8-VNka0rc6IO65hZk47UgRQulgC7bwjzJpnuFpTV7ZfnKxzRoe_ULV_WckXw18ojioo5iD91oGktIyYux1KAFU6wA0RuEKU_8h9oT6cScWkVg6umlzwQz1bXfAFwPQERvM5f3DiAL6t06tIUHv0TvV-vWW2bH9iMk7Y3kEcmS3hTlVlaROcY16ErhGDeuiF8yVQvwDFf-Ud5pSl4-wV]--></g></svg>